---
title: 'Analysis of Kriging modeling of zinc in Meuse river'
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Methodology

Our analysis commenced with the exploration and preparation of the "Meuse" dataset using essential libraries such as gstat, tidyverse, viridis, sf, sp, stars, patchwork, and ggplot2. This step involved loading the dataset into the R session and inspecting its structure using class() and head() functions to ensure data integrity and gain initial insights into the variables.

Subsequently, the "Meuse" dataset was converted into a spatial feature object (sf) using the st_as_sf() function, with spatial coordinates set to the columns "x" and "y". This transformation facilitated spatial analysis and visualization, enabling the plotting of the dataset using ggplot2 with adjusted parameters for enhanced readability and clarity.

To further enrich our analysis, the "meuse.grid" dataset containing gridded environmental variables was loaded. Spatial coordinates for this dataset were also set to columns "x" and "y" using the coordinates() function, ensuring alignment with the "Meuse" dataset for subsequent spatial analysis and modeling tasks.

Our analysis then proceeded with the implementation of interpolation techniques, starting with Inverse Distance Weighting (IDW). IDW was applied using the idw() function to estimate zinc concentrations across the study area. Predicted values were extracted and converted to a data frame for further analysis and visualization.

Following IDW interpolation, kriging modeling was conducted to provide more sophisticated spatial predictions of zinc concentrations. Exploratory Data Analysis (EDA) was performed to identify relationships in the zinc distribution, guiding model selection and parameterization.

Three kriging approaches were explored: Ordinary Kriging (OK), Universal Kriging, and Regression Kriging. Each approach involved variogram analysis, model fitting, and kriging prediction. Predicted values were plotted using ggplot2 for visual comparison and evaluation.

Finally, the predictions from all kriging approaches and IDW interpolation were juxtaposed using patchwork to facilitate comparison and assessment of their performance in predicting zinc concentrations across the study area. This comprehensive methodology allowed for a thorough exploration and analysis of kriging modeling for zinc in the Meuse river region.

## Load necessary libraries
```{r,warning=FALSE,message=FALSE}
library(gstat)
library(tidyverse)
library(viridis)
library(sf)
library(sp)
library(stars)
library(patchwork)
library(ggplot2)
```

# Exploring Zinc Concentrations in the Meuse Dataset: A Preliminary EDA Before Interpolation

loads the dataset named "meuse" into the current R session.check the data type. show the column content details.
```{r,warning=FALSE,message=FALSE}
data(meuse)
str(meuse)
head(meuse)
```

### Summary statistics for zinc
The summary statistics for zinc concentrations in the Meuse dataset indicate a positively skewed distribution with a median of 326 µg/g and a mean of 469.7 µg/g, ranging from 113 µg/g to 1839 µg/g.
```{r,warning=FALSE,message=FALSE}
summary(meuse$zinc)
```

### Boxplot of zinc concentrations
The absence of extreme outliers in the boxplot suggests that the dataset is likely suitable for further analysis without the need for data adjustments.
```{r,warning=FALSE,message=FALSE}
boxplot(meuse$zinc, main = "Boxplot of Zinc Concentrations")
```

Convert the "meuse" dataset to a spatial feature object (sf) with coordinates "x" and "y".
```{r,warning=FALSE,message=FALSE}
meuse_sf <- st_as_sf(meuse, coords = c("x", "y"))
```

## Zinc Concentration Spatial Distribution in Meuse

### map zinc spatiol distribution
Geographical trends in zinc concentration distribution within the Meuse dataset reveal higher levels near the riverbank, gradually decreasing towards inland areas
It has clear indication on relation ship with the distance to the river from river bank.
```{r,warning=FALSE,message=FALSE}
ggplot() +
  geom_sf(data = meuse_sf, aes(color = zinc), size = 2, alpha = 0.7) +
  scale_color_viridis() +
  theme_minimal() + # reduce unnecessary clutter
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
        axis.title = element_text(size = 14))  +  # Adjust axis title size
  labs(x = "X Coordinate", y = "Y Coordinate")  # Add axis labels
```

### Exploring Zinc Concentration with Distance relationship

Load the "meuse.grid" dataset containing gridded environmental variables for spatial analysis and modeling.
```{r,warning=FALSE,message=FALSE}
data(meuse.grid)
coordinates(meuse) <- c("x", "y")
coordinates(meuse.grid) <- c("x", "y")
```


Set the spatial coordinates for "meuse.grid" dataset to columns "x" and "y".
The distribution of zinc concentration with distance suggests a logarithmic trend

```{r,warning=FALSE,message=FALSE}
ggplot(meuse_sf,aes(y=zinc,x=dist))+geom_point()
```

further more we are using square root distance with the distancce then we can obain clear relationship as below chart.
```{r,warning=FALSE,message=FALSE}
ggplot(meuse_sf,aes(y=log(zinc),x=sqrt(dist)))+geom_point()
```

# Interpolation with Universal krigin

## Universal kriging


## fitting variogram
we further gig it with variogram analysis on that relationship in spacial pattern
```{r,warning=FALSE,message=FALSE}

vgmUni=variogram(log(zinc)~sqrt(dist), meuse)
vgmUK.fit = fit.variogram(vgmUni,  model = vgm(1, "Sph", 900, 1))

plot(vgmUni,vgmUK.fit )
```

```{r,warning=FALSE,message=FALSE}
k11<- krige(log(zinc) ~ 1, meuse, meuse.grid, model = vgmUK.fit )
k11_df <- data.frame(coordinates(meuse.grid), zinc_predicted = k11$var1.pred)
```
## check isotropy

check whether distribution is not vary across the different angels.we taken 0 , 45 , 135 rotations.
it seems our variogram is fitted to the applide model. and we can assume that the this satisfied isotropy conditioon.
```{r,warning=FALSE,message=FALSE}
v1.ani <- variogram(log(zinc)~sqrt(dist), alpha = c(0, 45, 90, 135), meuse)
fit.ani <- vgm(psill=.23, model = "Exp", range = 750, nugget = 0.06, anis = c(30, 10, 0, 0.5, 0.3))
plot(v1.ani, fit.ani)
```

## Plot prediction Universal kriging
we now do the prediction with our above kringng model with interpolated values.
```{r,warning=FALSE,message=FALSE}

ggplot(k11_df, aes(x = x, y = y, fill = zinc_predicted)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc",title = "Universal kriging Predictions of Zinc") +
  theme_minimal() +
  coord_equal()

```

#  Interpolation with Ordinary Kriging. - Dig more on krigin

## We further fit a kriging with Ordinary krigin for interpolation

## Fit variogram with Ordinary kriging
```{r,warning=FALSE,message=FALSE}
vgm1 = variogram(log(zinc)~1, meuse)

vgm1.fit = fit.variogram(vgm1, model = vgm(psill = 1, model = "Sph", range = 900, nugget = 1))
plot(vgm1, vgm1.fit)
```

## model fit with Ordinary Kriging.
```{r,warning=FALSE,message=FALSE}
lzn.okriging <- krige(log(zinc) ~ 1, meuse, meuse.grid, model = vgm1.fit)

kriged_df <- data.frame(coordinates(meuse.grid), zinc_predicted = lzn.okriging$var1.pred)
```
## check isotropy in Ordinary kriging
```{r,warning=FALSE,message=FALSE}
v2.ani <- variogram(log(zinc) ~ 1, alpha = c(0, 45, 90, 135), meuse)
fit2.ani <- vgm(psill=1, model = "Exp", range = 750, nugget = 0.06, anis = c(30, 10, 0, 0.5, 0.3))
plot(v2.ani, fit2.ani)
```

## Plot using Ordinary Kriging map graph


```{r,warning=FALSE,message=FALSE}
kriged_df <- data.frame(coordinates(meuse.grid), zinc_predicted = lzn.okriging$var1.pred)
ggplot(kriged_df, aes(x = x, y = y, fill = zinc_predicted)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc") +
  theme_minimal()+
  coord_equal()
```

#  Interpolation with Inverse Distance Weighting (IDW) Interpoliation spatially continous zinc distribution

as with above interplication we futher interpolation do with the IDW with Interpoliation spatially continous zinc distribution

## do IDW on zinc spacial continous distribution
```{r,warning=FALSE,message=FALSE}
zinc.idw <- idw(zinc ~ 1, meuse, meuse.grid)
```

Extract predicted values
do the prediction with IDW method.
```{r,warning=FALSE,message=FALSE}
zinc_idw_pred <- data.frame(coordinates(meuse.grid), zinc = zinc.idw$var1.pred)
```

Convert to data.frame
```{r,warning=FALSE,message=FALSE}
zinc_idw_df <- as.data.frame(zinc_idw_pred)
```

## Plot using ggplot2
we draw graph with IDW interpolated method.
```{r,warning=FALSE,message=FALSE}
ggplot(zinc_idw_df, aes(x = x, y = y, fill = zinc)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc") +
  theme_minimal() +
  coord_equal()
```


