---
title: 'Analysis of Kriging modeling of zinc in Meuse river'
author:
- -D.G.P. Madhushanka (MSC-DSA-098)
output:
  html_document:
    toc: true
    theme: united
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Methodology
In this study, we focused on understanding how zinc concentrations are distributed along the Meuse river using advanced spatial analysis techniques, particularly kriging methods. We began by thoroughly examining the Meuse dataset to understand its structure and content, which provided the foundation for our analysis. Through exploratory data analysis (EDA), we gained valuable insights into the distribution patterns of zinc concentrations, using techniques like calculating summary statistics and creating visualizations such as boxplots and spatial maps.

Once we grasped the nature of the data, we transitioned to spatial data preparation, transforming the dataset into a spatial feature object. This step enabled us to capture the spatial relationships inherent in the data, essential for subsequent analyses, especially kriging.

For the core of our analysis, we employed three primary Spatial interpolation techniques: Inverse Distance Weighting (IDW), Ordinary Kriging (OK), and Regression Kriging. These methods, particularly OK and Regression Kriging, offer sophisticated approaches to spatial interpolation, considering both spatial autocorrelation and a deterministic trend. We meticulously fine-tuned these kriging models, fitting variogram models and validating their performance to ensure accurate predictions.

The pinnacle of our study was the prediction and mapping of zinc concentrations across the Meuse river region using kriging. Leveraging the power of kriging, we generated detailed maps depicting spatially continuous predictions of zinc levels. These maps not only provided insights into the spatial variability of zinc concentrations but also highlighted potential hotspots and areas of environmental concern along the river.

In conclusion, our study showcases the effectiveness of Spatial interpolation techniques in analyzing and predicting spatial variations in zinc concentrations. By integrating advanced spatial analysis methods like kriging into our study, we were able to extract meaningful insights, contributing to a better understanding of environmental dynamics in the Meuse river region.

# Exploring Zinc Concentrations in the Meuse Dataset: A Preliminary EDA Before Interpolation

## Load necessary libraries
Before running this markdown, please install the following packages if not installed.
```{r,warning=FALSE,message=FALSE}
library(gstat)
library(tidyverse)
library(viridis)
library(sf)
library(sp)
library(stars)
library(patchwork)
library(ggplot2)
```
## Load Meuse dataset and display its structure and first few row
loads the dataset named "meuse" into the current R session.check the data type. show the column content details.
```{r,warning=FALSE,message=FALSE}
data(meuse)
str(meuse)
head(meuse)
```

### Summary statistics for zinc
The summary statistics for zinc concentrations in the Meuse dataset indicate a positively skewed distribution with a median of 326 µg/g and a mean of 469.7 µg/g, ranging from 113 µg/g to 1839 µg/g.
```{r,warning=FALSE,message=FALSE}
summary(meuse$zinc)
```

### Boxplot of zinc concentrations
The absence of extreme outliers in the boxplot suggests that the dataset is likely suitable for further analysis without the need for data adjustments.
```{r,warning=FALSE,message=FALSE}
boxplot(meuse$zinc, main = "Boxplot of Zinc Concentrations")
```

Convert the "meuse" dataset to a spatial feature object (sf) with coordinates "x" and "y".
```{r,warning=FALSE,message=FALSE}
meuse_sf <- st_as_sf(meuse, coords = c("x", "y"))
```

## Zinc Concentration Spatial Distribution in Meuse

### map zinc spatiol distribution
Geographical trends in zinc concentration distribution within the Meuse dataset reveal higher levels near the riverbank, gradually decreasing towards inland areas
It has clear indication on relation ship with the distance to the river from river bank.
```{r,warning=FALSE,message=FALSE}
ggplot() +
  geom_sf(data = meuse_sf, aes(color = zinc), size = 2, alpha = 0.7) +
  scale_color_viridis() +
  theme_minimal() + # reduce unnecessary clutter
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
        axis.title = element_text(size = 14))  +  # Adjust axis title size
  labs(x = "X Coordinate", y = "Y Coordinate")  # Add axis labels
```

### Exploring Zinc Concentration with Distance relationship

Load the "meuse.grid" dataset containing gridded environmental variables for spatial analysis and modeling.
```{r,warning=FALSE,message=FALSE}
data(meuse.grid)
coordinates(meuse) <- c("x", "y")
coordinates(meuse.grid) <- c("x", "y")
```


Set the spatial coordinates for "meuse.grid" dataset to columns "x" and "y".
The distribution of zinc concentration with distance suggests a logarithmic trend

```{r,warning=FALSE,message=FALSE}
ggplot(meuse_sf,aes(y=zinc,x=dist))+geom_point()
```

further more we are using square root distance with the distancce then we can obain clear relationship as below chart.
```{r,warning=FALSE,message=FALSE}
ggplot(meuse_sf,aes(y=log(zinc),x=sqrt(dist)))+geom_point()
```

# Interpolation with Regression krigin

## Fitting variogram
we further gig it with variogram analysis on that relationship in spacial pattern
```{r,warning=FALSE,message=FALSE}

vgmUni=variogram(log(zinc)~sqrt(dist), meuse)
vgmRegression.fit = fit.variogram(vgmUni,  model = vgm(1, "Sph", 900, 1))

plot(vgmUni,vgmRegression.fit )
```

## Prediction with Regression kriging
```{r,warning=FALSE,message=FALSE}
k11<- krige(log(zinc) ~ 1, meuse, meuse.grid, model = vgmRegression.fit )
k11_df <- data.frame(coordinates(meuse.grid), zinc_predicted = k11$var1.pred)
```
## Check isotropy

check whether distribution is not vary across the different angels.we taken 0 , 45 , 135 rotations.
it seems our variogram is fitted to the applide model. and we can assume that the this satisfied isotropy conditioon.
```{r,warning=FALSE,message=FALSE}
v1.ani <- variogram(log(zinc)~sqrt(dist), alpha = c(0, 45, 90, 135), meuse)
fit.ani <- vgm(psill=.23, model = "Exp", range = 750, nugget = 0.06, anis = c(30, 10, 0, 0.5, 0.3))
plot(v1.ani, fit.ani)
```

## Plot prediction Regression kriging
we now do the prediction with our above kringng model with interpolated values.
```{r,warning=FALSE,message=FALSE}

ggplot(k11_df, aes(x = x, y = y, fill = zinc_predicted)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc",title = "Regression kriging Predictions of Zinc") +
  theme_minimal() +
  coord_equal()

```
## Validation with cross validations.
```{r,warning=FALSE,message=FALSE}
k11.okriging.cv <- krige.cv(log(zinc) ~ 1, meuse, model = vgmRegression.fit)

```
### RMSE in Regression Kriging
```{r,warning=FALSE,message=FALSE}
round(sqrt(mean(k11.okriging.cv$residual^2)), 2)
```

#  Interpolation with Ordinary Kriging. 
We further fit a kriging with Ordinary krigin for interpolation

## Fit variogram with Ordinary kriging
```{r,warning=FALSE,message=FALSE}
vgm1 = variogram(log(zinc)~1, meuse)

vgm1.fit = fit.variogram(vgm1, model = vgm(psill = 1, model = "Sph", range = 900, nugget = 1))
plot(vgm1, vgm1.fit)
```

## Model fit with Ordinary Kriging.
```{r,warning=FALSE,message=FALSE}
lzn.okriging <- krige(log(zinc) ~ 1, meuse, meuse.grid, model = vgm1.fit)

kriged_df <- data.frame(coordinates(meuse.grid), zinc_predicted = lzn.okriging$var1.pred)
```
## Check isotropy in Ordinary kriging
```{r,warning=FALSE,message=FALSE}
v2.ani <- variogram(log(zinc) ~ 1, alpha = c(0, 45, 90, 135), meuse)
fit2.ani <- vgm(psill=1, model = "Exp", range = 750, nugget = 0.06, anis = c(30, 10, 0, 0.5, 0.3))
plot(v2.ani, fit2.ani)
```

## Plot using Ordinary Kriging map graph


```{r,warning=FALSE,message=FALSE}
kriged_df <- data.frame(coordinates(meuse.grid), zinc_predicted = lzn.okriging$var1.pred)
ggplot(kriged_df, aes(x = x, y = y, fill = zinc_predicted)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc") +
  theme_minimal()+
  coord_equal()
```

## Validation with cross validations Ordinary kriging
```{r,warning=FALSE,message=FALSE}
lzn.okriging.cv <- krige.cv(log(zinc) ~ 1, meuse, model = vgm1.fit)

```
### RMSE in Ordinary Kriging.
```{r,warning=FALSE,message=FALSE}
round(sqrt(mean(lzn.okriging.cv$residual^2)), 2)
```


#  Interpolation with Inverse Distance Weighting (IDW)

as with above interplication we futher interpolation do with the IDW with Interpoliation spatially continous zinc distribution

## IDW on zinc spacial continous distribution
```{r,warning=FALSE,message=FALSE}
zinc.idw <- idw(zinc ~ 1, meuse, meuse.grid)
```

Extract predicted values
do the prediction with IDW method.
```{r,warning=FALSE,message=FALSE}
zinc_idw_pred <- data.frame(coordinates(meuse.grid), zinc = zinc.idw$var1.pred)
```

Convert to data.frame
```{r,warning=FALSE,message=FALSE}
zinc_idw_df <- as.data.frame(zinc_idw_pred)
```

## Plot using IDW map graph
we draw graph with IDW interpolated method.
```{r,warning=FALSE,message=FALSE}
ggplot(zinc_idw_df, aes(x = x, y = y, fill = zinc)) +
  geom_tile() +
  scale_fill_viridis() +
  labs(fill = "Predicted Zinc") +
  theme_minimal() +
  coord_equal()
```

# Concluton

In this analysis of zinc concentrations in the Meuse river region, we employed various spatial interpolation techniques to predict zinc levels across the area. Our exploration began with an examination of the Meuse dataset, revealing spatial patterns in zinc distribution. We then conducted Inverse Distance Weighting (IDW), Ordinary Kriging (OK), and Regression Kriging to interpolate zinc concentrations.

Through exploratory data analysis (EDA) and variogram analysis, we identified spatial relationships and fitted appropriate models for kriging. The resulting kriging predictions provided detailed maps of zinc concentrations, showcasing higher levels near the riverbank and gradual decreases inland. We also compared the performance of each interpolation method, noting the strengths and limitations of IDW, OK, and Regression Kriging in capturing spatial variations in zinc levels.

Overall, our analysis demonstrates the utility of kriging techniques in predicting spatially continuous environmental variables like zinc concentrations. By leveraging spatial relationships and variogram modeling, kriging methods offer valuable insights into pollutant distribution patterns, aiding environmental monitoring and management efforts in the Meuse river region and similar areas.

